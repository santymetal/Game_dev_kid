<!DOCTYPE html>
<html>
<head>
    <title>Game Test</title>
</head>
<body>
    <canvas id="testCanvas" width="600" height="400" style="border: 1px solid black;"></canvas>
    <script>
        const canvas = document.getElementById('testCanvas');
        const ctx = canvas.getContext('2d');
        
        // Test the exact game code format
        const testGameCode = `
        const game = {
          player: { x: 50, y: 300, width: 40, height: 40, velocityY: 0, onGround: true },
          platforms: [
            { x: 0, y: 350, width: 200, height: 20 },
            { x: 250, y: 300, width: 150, height: 20 },
            { x: 450, y: 250, width: 150, height: 20 }
          ],
          collectibles: [
            { x: 300, y: 270, collected: false },
            { x: 500, y: 220, collected: false }
          ],
          score: 0,
          keys: {},
          gravity: 0.8,
          playerSpeed: 3,
          jumpPower: -15,
          characterColor: '#32CD32',
          bgColor: '#E6FFE6',
          collectibleType: 'Golden Stars'
        };

        function update() {
          if (!game.player.onGround) {
            game.player.velocityY += game.gravity;
          }
          
          if (game.keys['ArrowLeft']) game.player.x -= game.playerSpeed;
          if (game.keys['ArrowRight']) game.player.x += game.playerSpeed;
          if (game.keys[' '] && game.player.onGround) {
            game.player.velocityY = game.jumpPower;
            game.player.onGround = false;
          }
          
          game.player.y += game.player.velocityY;
          
          game.player.onGround = false;
          game.platforms.forEach(platform => {
            if (game.player.x < platform.x + platform.width &&
                game.player.x + game.player.width > platform.x &&
                game.player.y + game.player.height > platform.y &&
                game.player.y + game.player.height < platform.y + platform.height + 10) {
              game.player.y = platform.y - game.player.height;
              game.player.velocityY = 0;
              game.player.onGround = true;
            }
          });
          
          game.collectibles.forEach(item => {
            if (!item.collected && 
                Math.abs(game.player.x - item.x) < 30 && 
                Math.abs(game.player.y - item.y) < 30) {
              item.collected = true;
              game.score += 10;
            }
          });
        }
        
        function render(ctx, canvas) {
          ctx.fillStyle = game.bgColor;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          
          ctx.fillStyle = '#8B4513';
          game.platforms.forEach(platform => {
            ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
          });
          
          ctx.fillStyle = game.characterColor;
          ctx.fillRect(game.player.x, game.player.y, game.player.width, game.player.height);
          
          const collectibleColor = game.collectibleType.includes('Stars') ? '#FFD700' : 
                                  game.collectibleType.includes('Apples') ? '#FF0000' : '#FF69B4';
          ctx.fillStyle = collectibleColor;
          game.collectibles.forEach(item => {
            if (!item.collected) {
              ctx.beginPath();
              ctx.arc(item.x, item.y, 10, 0, Math.PI * 2);
              ctx.fill();
            }
          });
          
          ctx.fillStyle = '#000';
          ctx.font = '20px Arial';
          ctx.fillText('Score: ' + game.score, 10, 30);
          ctx.fillText('Collect: ' + game.collectibleType.split(' ')[1], 10, 60);
        }
        
        return { game, update, render };
        `;
        
        try {
            const gameFunction = new Function(testGameCode);
            const gameInstance = gameFunction();
            
            console.log('Game instance:', gameInstance);
            
            function gameLoop() {
                gameInstance.update();
                gameInstance.render(ctx, canvas);
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
            
        } catch (error) {
            console.error('Test failed:', error);
            ctx.fillStyle = 'red';
            ctx.fillText('Game test failed: ' + error.message, 10, 50);
        }
    </script>
</body>
</html>